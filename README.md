# 股票K线图可视化平台

一个基于Flask和TradingView Lightweight Charts的股票K线图可视化平台，支持本地CSV数据源和智能历史数据加载。

## 🌟 功能特点

- 📊 **双图表布局**：K线图 + 成交量图，时间轴同步
- 🔄 **智能数据加载**：拖拽时自动加载历史数据，支持跨年份数据读取
- 📍 **位置保持**：拖拽和缩放后加载新数据时保持用户视图位置
- 📅 **灵活日期查询**：支持任意截止日期的数据查询
- 📈 **移动平均线**：支持MA5、MA10、MA20移动平均线显示
- 🎯 **多周期支持**：支持日线、周线、月线等不同时间周期
- 🖱️ **流畅交互**：支持鼠标拖拽、滚轮缩放，操作体验流畅

## 💻 系统要求

- Python 3.7+
- 现代浏览器（Chrome、Firefox、Safari、Edge）

## 🚀 快速开始

### 1. 安装Python依赖
```bash
pip install flask pandas requests
```

### 2. 准备数据文件

#### 数据目录结构
```
E:\work\stock\data\
├── 2024\
│   ├── SZ.002951.csv
│   ├── SZ.000001.csv
│   └── ...
├── 2025\
│   ├── SZ.002951.csv
│   ├── SZ.000001.csv
│   └── ...
└── ...
```

#### 数据文件格式
CSV文件应包含以下列（按顺序）：
```
日期,代码,开盘价,最高价,最低价,收盘价,成交量（手）,成交额（元）
```

示例数据：
```csv
2025-01-02 09:31:00,SZ.002951,6.15,6.19,6.09,6.15,3961,24356.0
2025-01-02 09:32:00,SZ.002951,6.16,6.18,6.14,6.17,2845,17523.0
```

### 3. 配置数据路径

编辑 `config.py` 文件，设置您的数据路径：
```python
LOCAL_DATA_PATH = r"E:\work\stock\data"  # 修改为您的数据路径
```

### 4. 启动服务器
```bash
python app.py
```

服务器将在 `http://127.0.0.1:5000` 启动

### 5. 打开浏览器
访问 `http://127.0.0.1:5000` 开始使用！

## 📖 使用指南

### 基本操作

#### 查看K线图
1. 在股票代码输入框中输入股票代码（如：002951）
2. 选择时间周期（日线D、周线W、月线M）
3. 设置截止日期（可选，格式：YYYY-MM-DD）
4. 点击"加载K线图"按钮

#### 图表交互
- **拖拽**：按住鼠标左键拖拽图表查看不同时间段
- **缩放**：使用鼠标滚轮放大/缩小图表
- **自动加载**：拖拽到数据边界时自动加载更多历史数据

#### 高级功能
- **测试历史数据**：点击"测试历史数据"按钮手动触发数据加载
- **移动平均线**：图表自动显示MA5、MA10、MA20移动平均线
- **成交量图**：下方自动显示对应的成交量柱状图

### 支持的股票代码格式
- `002951` - 深圳股票代码
- `000001` - 深圳股票代码
- `600000` - 上海股票代码

## 🔧 API接口

### 获取K线数据
```
GET /api/kline
```

**参数：**
- `code`: 股票代码（必需）
- `period`: 时间周期，D=日线，W=周线，M=月线（默认：D）
- `limit`: 返回数据条数（默认：1000）
- `end_date`: 截止日期，格式：YYYY-MM-DD（可选）
- `start_date`: 开始日期，格式：YYYY-MM-DD（可选）

**示例：**
```
http://127.0.0.1:5000/api/kline?code=002951&period=D&limit=100&end_date=2024-06-06
```

**返回格式：**
```json
[
  {
    "date": "2024-06-05 00:00:00",
    "open": 6.09,
    "high": 6.19,
    "low": 6.09,
    "close": 6.15,
    "volume": 3961.0
  }
]
```

## 🛠️ 故障排除

### 常见问题

**1. K线图不显示**
- ✅ 检查股票代码是否正确
- ✅ 确认数据文件是否存在于对应年份目录
- ✅ 查看浏览器控制台（F12）是否有错误信息

**2. 数据加载失败**
- ✅ 检查 `config.py` 中的数据文件路径配置
- ✅ 确认CSV文件格式是否符合要求
- ✅ 查看服务器终端日志输出

**3. 拖拽后图表位置跳动**
- ✅ 这是正常现象，系统会在加载新数据后恢复您的视图位置
- ✅ 如果位置恢复不准确，请查看浏览器控制台日志

**4. 截止日期查询无结果**
- ✅ 确认该日期范围内有对应的数据文件
- ✅ 检查日期格式是否正确（YYYY-MM-DD）

### 调试模式

查看详细日志：
1. 打开浏览器开发者工具（F12）
2. 切换到Console标签页
3. 观察操作时的日志输出

## 🏗️ 技术架构

- **前端**：HTML + JavaScript + TradingView Lightweight Charts
- **后端**：Flask + Python
- **数据处理**：Pandas（支持跨年份数据合并、1分钟级数据聚合）
- **数据源**：本地CSV文件（按年份目录组织）

## 📁 项目结构

```
Ashare-mcp-main/
├── app.py              # Flask主应用
├── Ashare.py           # 数据处理模块
├── config.py           # 配置文件
├── templates/
│   └── index.html      # 主页面模板
├── static/
│   ├── css/
│   │   └── style.css   # 样式文件
│   └── js/
│       └── main.js     # 前端JavaScript逻辑
└── README.md           # 本文件
```

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

本项目采用MIT许可证 - 详见LICENSE文件