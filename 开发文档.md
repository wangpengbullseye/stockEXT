# ğŸ“Š è‚¡ç¥¨Kçº¿å›¾å¯è§†åŒ–å¹³å° - å¼€å‘æ–‡æ¡£

> åŸºäºFlask + TradingView Lightweight Chartsçš„ä¸“ä¸šè‚¡ç¥¨åˆ†æå·¥å…·
> 
> ğŸš€ æœ¬åœ°æ•°æ®æº | ğŸ¨ ä¸“ä¸šç”»çº¿å·¥å…· | ğŸ¬ åŠ¨ç”»æ’­æ”¾ | ğŸ“ˆ å¤šå‘¨æœŸæ”¯æŒ

## ğŸ“‹ ç›®å½•

- [ğŸ¯ é¡¹ç›®æ¦‚è¿°](#-é¡¹ç›®æ¦‚è¿°)
- [ğŸ—ï¸ æŠ€æœ¯æ¶æ„](#ï¸-æŠ€æœ¯æ¶æ„)
- [ğŸŒŸ åŠŸèƒ½ç‰¹æ€§è¯¦è§£](#-åŠŸèƒ½ç‰¹æ€§è¯¦è§£)
- [ğŸ”§ APIæ¥å£æ–‡æ¡£](#-apiæ¥å£æ–‡æ¡£)
- [ğŸ¨ å‰ç«¯æ¶æ„è¯¦è§£](#-å‰ç«¯æ¶æ„è¯¦è§£)
- [âš™ï¸ åç«¯æ¶æ„è¯¦è§£](#ï¸-åç«¯æ¶æ„è¯¦è§£)
- [ğŸš€ éƒ¨ç½²æŒ‡å—](#-éƒ¨ç½²æŒ‡å—)
- [ğŸ‘¨â€ğŸ’» å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [ğŸ”§ æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### ğŸŒŸ é¡¹ç›®äº®ç‚¹

è¿™æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§è‚¡ç¥¨Kçº¿å›¾å¯è§†åŒ–å¹³å°**ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒæœ¬åœ°CSVæ•°æ®æºå’Œæ™ºèƒ½å†å²æ•°æ®åŠ è½½ã€‚é¡¹ç›®ä»åŸæ¥çš„ç½‘ç»œæ•°æ®æºæ”¹é€ ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ•°æ®æºï¼Œæä¾›äº†æ›´ç¨³å®šã€æ›´å¿«é€Ÿçš„æ•°æ®è®¿é—®èƒ½åŠ›ã€‚

### ğŸ¨ æ ¸å¿ƒç‰¹è‰²

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| ğŸ—ï¸ **åŒå›¾è¡¨å¸ƒå±€** | Kçº¿å›¾ + æˆäº¤é‡å›¾ï¼Œæ—¶é—´è½´å®Œç¾åŒæ­¥ï¼Œæ”¯æŒMA5ã€MA10ã€MA20ç§»åŠ¨å¹³å‡çº¿æ˜¾ç¤º |
| ğŸ”„ **æ™ºèƒ½æ•°æ®åŠ è½½** | æ‹–æ‹½æ—¶è‡ªåŠ¨åŠ è½½å†å²æ•°æ®ï¼Œæ”¯æŒè·¨å¹´ä»½æ•°æ®è¯»å–ï¼Œä½ç½®ä¿æŒåŠŸèƒ½ |
| ğŸ¬ **åŠ¨ç”»æ’­æ”¾ç³»ç»Ÿ** | æ”¯æŒKçº¿å½¢æˆè¿‡ç¨‹çš„åŠ¨ç”»æ’­æ”¾ï¼Œå¯è°ƒèŠ‚æ’­æ”¾é€Ÿåº¦ï¼Œæ¨¡æ‹ŸçœŸå®äº¤æ˜“è¿‡ç¨‹ |
| ğŸ¨ **ä¸“ä¸šç”»çº¿å·¥å…·** | è¶‹åŠ¿çº¿ã€æ°´å¹³çº¿ã€å‚ç›´çº¿ã€çŸ©å½¢ç­‰ä¸“ä¸šç»˜å›¾å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨æ•æ‰å’Œåˆ é™¤åŠŸèƒ½ |
| ğŸ“… **å¤šå‘¨æœŸæ”¯æŒ** | æ”¯æŒ1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿã€30åˆ†é’Ÿã€60åˆ†é’Ÿã€æ—¥çº¿ã€å‘¨çº¿ã€æœˆçº¿ |
| ğŸ’¾ **æœ¬åœ°æ•°æ®ä¼˜å…ˆ** | æœ¬åœ°CSVæ–‡ä»¶ä¼˜å…ˆï¼Œç½‘ç»œæ•°æ®å¤‡ç”¨ï¼Œæ”¯æŒç¦»çº¿ä½¿ç”¨å’Œå¿«é€Ÿè®¿é—® |

### ğŸ“Š æŠ€æœ¯æŒ‡æ ‡

- **5900+** è¡Œå‰ç«¯ä»£ç 
- **449** è¡Œæ•°æ®å¤„ç†é€»è¾‘  
- **128** è¡ŒFlaskåç«¯
- **å¤šå¹´ä»½** æ•°æ®æ”¯æŒ
- **å®æ—¶** æ•°æ®å¤„ç†
- **ä¸“ä¸š** é‡‘èå›¾è¡¨

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ğŸ“š æŠ€æœ¯æ ˆ

#### ğŸ¨ å‰ç«¯æŠ€æœ¯æ ˆ
- **HTML5** - ç°ä»£åŒ–æ ‡è®°è¯­è¨€
- **JavaScript ES6+** - ç°ä»£JavaScriptç‰¹æ€§
- **Bootstrap 5.1.3** - å“åº”å¼UIæ¡†æ¶
- **TradingView Lightweight Charts** - ä¸“ä¸šé‡‘èå›¾è¡¨åº“
- **CSS3** - ç°ä»£æ ·å¼å’ŒåŠ¨ç”»

#### âš™ï¸ åç«¯æŠ€æœ¯æ ˆ
- **Python 3.7+** - ä¸»è¦ç¼–ç¨‹è¯­è¨€
- **Flask 2.3.3** - è½»é‡çº§Webæ¡†æ¶
- **Pandas 2.0.3** - æ•°æ®å¤„ç†åº“
- **NumPy 1.24.3** - æ•°å€¼è®¡ç®—åº“
- **Requests 2.31.0** - HTTPè¯·æ±‚åº“

#### ğŸ’¾ æ•°æ®å­˜å‚¨
- **æœ¬åœ°CSVæ–‡ä»¶** - ä¸»è¦æ•°æ®æº
- **æŒ‰å¹´ä»½ç›®å½•ç»„ç»‡** - ä¾¿äºç®¡ç†
- **ç½‘ç»œæ•°æ®æºå¤‡ç”¨** - å®¹é”™æœºåˆ¶
- **æ™ºèƒ½æ•°æ®èšåˆ** - å¤šå‘¨æœŸæ”¯æŒ

### ğŸ“ é¡¹ç›®ç»“æ„

```
Ashare-mcp-main/
â”œâ”€â”€ app.py              # Flaskä¸»åº”ç”¨ï¼ŒRESTful API
â”œâ”€â”€ Ashare.py           # æ•°æ®å¤„ç†æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ config.py           # é…ç½®æ–‡ä»¶ç®¡ç†
â”œâ”€â”€ requirements.txt    # Pythonä¾èµ–
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html      # ä¸»é¡µé¢æ¨¡æ¿
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css   # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ main.js     # å‰ç«¯æ ¸å¿ƒé€»è¾‘(5900è¡Œ)
â”œâ”€â”€ test_data/
â”‚   â””â”€â”€ 2024/
â”‚       â”œâ”€â”€ SH.600000.csv # æµ‹è¯•æ•°æ®
â”‚       â””â”€â”€ SZ.000001.csv
â”œâ”€â”€ ashare_mcp/        # MCPæœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ __main__.py
â”‚   â””â”€â”€ server.py       # MCPæœåŠ¡å™¨
â””â”€â”€ README.md           # é¡¹ç›®æ–‡æ¡£
```

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§è¯¦è§£

### ğŸ“Š å›¾è¡¨åŠŸèƒ½

#### ğŸ¯ åŒå›¾è¡¨å¸ƒå±€

```javascript
// å›¾è¡¨åˆå§‹åŒ–
function initCharts() {
    // Kçº¿å›¾è¡¨
    klineChart = LightweightCharts.createChart(document.getElementById('klineChart'), {
        width: chartContainer.clientWidth,
        height: 400,
        timeScale: { timeVisible: true, secondsVisible: false }
    });
    
    // æˆäº¤é‡å›¾è¡¨
    volumeChart = LightweightCharts.createChart(document.getElementById('volumeChart'), {
        width: chartContainer.clientWidth,
        height: 150
    });
    
    // æ—¶é—´è½´åŒæ­¥
    klineChart.timeScale().subscribeVisibleTimeRangeChange(onVisibleTimeRangeChanged);
}
```

#### ğŸ“ˆ ç§»åŠ¨å¹³å‡çº¿ç³»ç»Ÿ

**âœ… æ”¯æŒçš„ç§»åŠ¨å¹³å‡çº¿ï¼š**
- **MA5** - 5æ—¥ç§»åŠ¨å¹³å‡çº¿ (çŸ­æœŸè¶‹åŠ¿)
- **MA10** - 10æ—¥ç§»åŠ¨å¹³å‡çº¿ (ä¸­çŸ­æœŸè¶‹åŠ¿)  
- **MA20** - 20æ—¥ç§»åŠ¨å¹³å‡çº¿ (ä¸­æœŸè¶‹åŠ¿)

### ğŸ¬ åŠ¨ç”»æ’­æ”¾ç³»ç»Ÿ

#### âš¡ æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| ğŸ® **æ’­æ”¾æ§åˆ¶** | æ”¯æŒæ’­æ”¾ã€æš‚åœã€åœæ­¢æ“ä½œï¼Œå¯è°ƒèŠ‚æ’­æ”¾é€Ÿåº¦ï¼ˆ1x-10xï¼‰ |
| ğŸ“Š **å®æ—¶èšåˆ** | åŸºäºåˆ†é’Ÿçº§æ•°æ®å®æ—¶èšåˆæˆä¸åŒå‘¨æœŸçš„Kçº¿ |
| ğŸ”„ **è¿ç»­æ’­æ”¾** | è‡ªåŠ¨åŠ è½½ä¸‹ä¸€å¤©æ•°æ®ï¼Œå®ç°è¿ç»­æ’­æ”¾ |
| â° **äº¤æ˜“æ—¶é—´** | ä¸¥æ ¼æŒ‰ç…§è‚¡å¸‚äº¤æ˜“æ—¶é—´è¿›è¡Œæ•°æ®èšåˆå’Œæ’­æ”¾ |

```javascript
// åŠ¨ç”»æ’­æ”¾æ ¸å¿ƒé€»è¾‘
function runAnimation() {
    if (!isPlaying) return;
    
    const currentPeriod = document.getElementById('period').value;
    const intervalMs = Math.max(50, 1000 / playbackSpeed);
    
    // å¤„ç†å½“å‰åˆ†é’Ÿæ•°æ®
    processMinuteDataForAnimation(currentPeriod);
    
    currentAnimationIndex++;
    
    // è®¾ç½®ä¸‹ä¸€æ¬¡åŠ¨ç”»
    animationTimer = setTimeout(() => {
        runAnimation();
    }, intervalMs);
}
```

### ğŸ¨ ä¸“ä¸šç”»çº¿å·¥å…·ç³»ç»Ÿ

#### ğŸ› ï¸ å·¥å…·ç±»å‹

| å·¥å…·åç§° | åŠŸèƒ½æè¿° | ç‰¹æ®ŠåŠŸèƒ½ | å¿«æ·é”® |
|---------|----------|----------|--------|
| ğŸ¯ **è¶‹åŠ¿çº¿** | ç»˜åˆ¶å°„çº¿ï¼Œä»ç¬¬ä¸€ç‚¹å»¶ä¼¸åˆ°æ— é™è¿œ | è‡ªåŠ¨æ•æ‰OHLCç‚¹ | T |
| â– **æ°´å¹³çº¿** | ç»˜åˆ¶æ°´å¹³æ”¯æ’‘/é˜»åŠ›çº¿ | ä»·æ ¼æ ‡ç­¾æ˜¾ç¤º | H |
| â¬‡ï¸ **å‚ç›´çº¿** | ç»˜åˆ¶å‚ç›´æ—¶é—´çº¿ | æ—¶é—´æ ‡ç­¾æ˜¾ç¤º | V |
| â¬œ **çŸ©å½¢** | ç»˜åˆ¶ä»·æ ¼åŒºé—´æ¡† | åŒºåŸŸé«˜äº® | R |

#### ğŸ¯ æ™ºèƒ½æ•æ‰ç³»ç»Ÿ

```javascript
// æ™ºèƒ½æ•æ‰OHLCç‚¹
findNearestOHLCPoint(mousePrice, candleData) {
    const ohlcPoints = [
        { price: candleData.open, type: 'open' },
        { price: candleData.high, type: 'high' },
        { price: candleData.low, type: 'low' },
        { price: candleData.close, type: 'close' }
    ];
    
    let nearest = null;
    let minDistance = Infinity;
    
    ohlcPoints.forEach(point => {
        const distance = Math.abs(point.price - mousePrice);
        if (distance < minDistance) {
            minDistance = distance;
            nearest = point;
        }
    });
    
    return nearest;
}
```

### ğŸ“… å¤šå‘¨æœŸæ•°æ®å¤„ç†

#### â° äº¤æ˜“æ—¶é—´èšåˆ

**ğŸ•˜ ä¸­å›½è‚¡å¸‚äº¤æ˜“æ—¶é—´**
- **ä¸Šåˆï¼š** 9:30-11:30 (2å°æ—¶) â†’ 9:30-10:30, 10:30-11:30
- **ä¸‹åˆï¼š** 13:00-15:00 (2å°æ—¶) â†’ 13:00-14:00, 14:00-15:00  
- **åˆä¼‘ï¼š** 11:30-13:00 (1.5å°æ—¶) - ä¸äº§ç”ŸKçº¿æ•°æ®

```python
def aggregate_hourly_trading_data(df):
    """
    æŒ‰ç…§è‚¡å¸‚äº¤æ˜“æ—¶é—´èšåˆå°æ—¶çº¿æ•°æ®
    """
    result_data = []
    
    # æŒ‰æ—¥æœŸåˆ†ç»„å¤„ç†
    df['date_only'] = df['date'].dt.date
    for date, day_data in df.groupby('date_only'):
        # ä¸Šåˆæ—¶æ®µï¼š9:30-11:30
        morning_data = day_data[
            (day_data['date'].dt.time >= pd.Timestamp('09:30:00').time()) &
            (day_data['date'].dt.time < pd.Timestamp('11:30:00').time())
        ]
        
        # ä¸‹åˆæ—¶æ®µï¼š13:00-15:00
        afternoon_data = day_data[
            (day_data['date'].dt.time >= pd.Timestamp('13:00:00').time()) &
            (day_data['date'].dt.time < pd.Timestamp('15:00:00').time())
        ]
        
        # èšåˆæ•°æ®...
    
    return pd.DataFrame(result_data)
```

## ğŸ”§ APIæ¥å£æ–‡æ¡£

### ğŸ“¡ RESTful API

#### ğŸ¯ è·å–Kçº¿æ•°æ®

```http
GET /api/kline
```

#### ğŸ“‹ è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `code` | string | âœ… æ˜¯ | sh000001 | è‚¡ç¥¨ä»£ç ï¼Œæ”¯æŒå¤šç§æ ¼å¼ |
| `period` | string | âš ï¸ å¦ | D | æ—¶é—´å‘¨æœŸï¼šD(æ—¥çº¿)ã€W(å‘¨çº¿)ã€M(æœˆçº¿)ã€1/5/15/30/60(åˆ†é’Ÿçº¿) |
| `limit` | integer | âš ï¸ å¦ | 1000 | è¿”å›æ•°æ®æ¡æ•°ï¼ŒèŒƒå›´ï¼š10-5000 |
| `end_date` | string | âš ï¸ å¦ | - | æˆªæ­¢æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD |
| `start_date` | string | âš ï¸ å¦ | - | å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD |
| `page` | integer | âš ï¸ å¦ | 1 | é¡µç ï¼Œç”¨äºåˆ†é¡µåŠ è½½ |

#### ğŸ“¤ å“åº”æ ¼å¼

```json
[
  {
    "date": "2024-06-05 00:00:00",
    "open": 6.09,
    "high": 6.19,
    "low": 6.09,
    "close": 6.15,
    "volume": 3961.0
  },
  {
    "date": "2024-06-06 00:00:00",
    "open": 6.15,
    "high": 6.25,
    "low": 6.10,
    "close": 6.20,
    "volume": 4200.0
  }
]
```

#### ğŸ¯ è¯·æ±‚ç¤ºä¾‹

```bash
# è·å–æµ¦å‘é“¶è¡Œæ—¥çº¿æ•°æ®
curl "http://127.0.0.1:5000/api/kline?code=600000&period=D&limit=100"

# è·å–å¹³å®‰é“¶è¡Œ5åˆ†é’Ÿçº¿æ•°æ®
curl "http://127.0.0.1:5000/api/kline?code=000001&period=5&limit=200"

# è·å–æŒ‡å®šæ—¥æœŸèŒƒå›´çš„æ•°æ®
curl "http://127.0.0.1:5000/api/kline?code=002951&period=D&start_date=2024-01-01&end_date=2024-06-30"
```

#### âš ï¸ é”™è¯¯å¤„ç†

**å¸¸è§é”™è¯¯å“åº”ï¼š**
```json
{
  "error": "Failed to get data from Ashare"
}
```

**å¯èƒ½åŸå› ï¼š**
- è‚¡ç¥¨ä»£ç ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯
- æœ¬åœ°æ•°æ®æ–‡ä»¶ç¼ºå¤±
- ç½‘ç»œæ•°æ®æºè®¿é—®å¤±è´¥
- æ—¥æœŸèŒƒå›´è¶…å‡ºæ•°æ®èŒƒå›´

### ğŸ”— è‚¡ç¥¨ä»£ç æ ¼å¼æ”¯æŒ

| æ ¼å¼ç±»å‹ | ç¤ºä¾‹ | è¯´æ˜ | å¸‚åœº |
|---------|------|------|------|
| å¸¦å‰ç¼€æ ¼å¼ | `sh600000`, `sz000001` | æ˜ç¡®æŒ‡å®šå¸‚åœº | ä¸Šæµ·/æ·±åœ³ |
| èšå®½æ ¼å¼ | `600000.XSHG`, `000001.XSHE` | èšå®½å¹³å°æ ‡å‡†æ ¼å¼ | ä¸Šæµ·/æ·±åœ³ |
| çº¯æ•°å­—æ ¼å¼ | `600000`, `000001` | 6å¼€å¤´é»˜è®¤ä¸Šæµ·ï¼Œå…¶ä»–é»˜è®¤æ·±åœ³ | è‡ªåŠ¨è¯†åˆ« |

## ğŸ¨ å‰ç«¯æ¶æ„è¯¦è§£

### ğŸ“Š TradingView Lightweight Chartsé›†æˆ

#### ğŸ¯ å›¾è¡¨é…ç½®

```javascript
// å›¾è¡¨é…ç½®é€‰é¡¹
const chartOptions = {
    width: chartContainer.clientWidth,
    height: 400,
    layout: {
        backgroundColor: '#ffffff',
        textColor: '#333333',
    },
    grid: {
        vertLines: { color: '#e1e1e1' },
        horzLines: { color: '#e1e1e1' },
    },
    timeScale: {
        timeVisible: true,
        secondsVisible: false,
        borderColor: '#cccccc',
    },
    rightPriceScale: {
        borderColor: '#cccccc',
    },
    crosshair: {
        mode: LightweightCharts.CrosshairMode.Normal,
    }
};
```

#### ğŸ“ˆ Kçº¿åºåˆ—é…ç½®

```javascript
// Kçº¿åºåˆ—é…ç½®
candleSeries = klineChart.addCandlestickSeries({
    upColor: '#ef5350',      // ä¸Šæ¶¨é¢œè‰²
    downColor: '#26a69a',    // ä¸‹è·Œé¢œè‰²
    borderVisible: false,
    wickUpColor: '#ef5350',
    wickDownColor: '#26a69a',
    priceFormat: {
        type: 'price',
        precision: 2,
        minMove: 0.01,
    }
});
```

### ğŸ¨ ç”»çº¿å·¥å…·æ¶æ„

#### ğŸ—ï¸ ç±»ç»§æ‰¿ç»“æ„

```
DrawingTool (åŸºç±»)
â”œâ”€â”€ HorizontalLineTool    # æ°´å¹³çº¿å·¥å…·
â”œâ”€â”€ VerticalLineTool      # å‚ç›´çº¿å·¥å…·
â”œâ”€â”€ TrendLineTool         # è¶‹åŠ¿çº¿å·¥å…·
â”œâ”€â”€ RectangleTool         # çŸ©å½¢å·¥å…·
â””â”€â”€ DrawingToolSystem     # å·¥å…·ç®¡ç†ç³»ç»Ÿ
```

#### ğŸ¯ çŠ¶æ€æœºæ¨¡å¼

```javascript
// ç”»çº¿å·¥å…·çŠ¶æ€æœº
class DrawingTool {
    constructor(chart, candleSeries) {
        this.state = 'idle'; // idle, drawing, preview
        this.points = [];
        this.previewSeries = null;
    }

    // çŠ¶æ€è½¬æ¢
    start() { this.state = 'drawing'; }
    finish() { this.state = 'idle'; }
    cancel() { this.state = 'idle'; }

    // äº‹ä»¶å¤„ç†
    onMouseMove(param) {
        if (this.state === 'drawing') {
            this.updatePreview(param);
        }
    }

    onClick(param) {
        if (this.state === 'drawing') {
            this.addPoint(param);
        }
    }
}
```

### ğŸ¬ åŠ¨ç”»ç³»ç»Ÿæ¶æ„

#### âš¡ æ•°æ®æµå¤„ç†

**ğŸ”„ åŠ¨ç”»æ•°æ®æµï¼š** åˆ†é’Ÿæ•°æ® â†’ å‘¨æœŸèšåˆ â†’ å›¾è¡¨æ›´æ–° â†’ ä¸‹ä¸€å¸§

- ğŸ“Š ä»æœ¬åœ°/ç½‘ç»œè·å–åˆ†é’Ÿçº§æ•°æ®
- â° æŒ‰äº¤æ˜“æ—¶é—´è¿›è¡Œå‘¨æœŸèšåˆ
- ğŸ“ˆ å®æ—¶æ›´æ–°å›¾è¡¨æ˜¾ç¤º
- ğŸ”„ å¾ªç¯å¤„ç†ä¸‹ä¸€åˆ†é’Ÿæ•°æ®

#### ğŸ® æ’­æ”¾æ§åˆ¶

```javascript
// åŠ¨ç”»æ’­æ”¾æ§åˆ¶
const animationStates = {
    STOPPED: 'stopped',
    PLAYING: 'playing',
    PAUSED: 'paused'
};

function togglePlayback() {
    switch(animationState) {
        case animationStates.STOPPED:
        case animationStates.PAUSED:
            startAnimation();
            break;
        case animationStates.PLAYING:
            pauseAnimation();
            break;
    }
}
```

## âš™ï¸ åç«¯æ¶æ„è¯¦è§£

### ğŸ—ï¸ Flaskåº”ç”¨ç»“æ„

#### ğŸ“¡ è·¯ç”±è®¾è®¡

```python
from flask import Flask, render_template, request, jsonify

app = Flask(__name__)

@app.route('/')
def index():
    """æ¸²æŸ“ä¸»é¡µ"""
    return render_template('index.html')

@app.route('/api/kline')
def get_kline():
    """è·å–Kçº¿æ•°æ®çš„API"""
    # å‚æ•°è§£æ
    code = request.args.get('code', 'sh000001')
    period = request.args.get('period', 'D')
    limit = int(request.args.get('limit', 1000))

    # æ•°æ®å¤„ç†
    df = Ashare.get_price(code, frequency=frequency, count=limit)

    # è¿”å›JSON
    return jsonify(result)
```

### ğŸ’¾ æ•°æ®å¤„ç†æ ¸å¿ƒ

#### ğŸ”„ æ™ºèƒ½æ•°æ®æºåˆ‡æ¢

```python
def get_price(code, end_date='', count=10, frequency='1d', fields=[], start_date=''):
    """å¯¹å¤–æš´éœ²çš„ç»Ÿä¸€æ•°æ®è·å–æ¥å£"""

    # ä¼˜å…ˆå°è¯•ä»æœ¬åœ°æ•°æ®æºè·å–æ•°æ®
    try:
        df_local = get_price_local(code, end_date=end_date, count=count,
                                 frequency=frequency, start_date=start_date)
        if not df_local.empty:
            print(f"âœ… æˆåŠŸä»æœ¬åœ°æ•°æ®æºè·å– {code} çš„æ•°æ®")
            return df_local
    except Exception as e:
        print(f"âš ï¸ æœ¬åœ°æ•°æ®æºè·å–å¤±è´¥: {e}ï¼Œå°è¯•ç½‘ç»œæ•°æ®æº...")

    # å¦‚æœæœ¬åœ°æ•°æ®è·å–å¤±è´¥ï¼Œä½¿ç”¨ç½‘ç»œæ•°æ®æº
    if frequency in ['1d','1w','1M']:
        try:
            return get_price_sina(xcode, end_date=end_date, count=count, frequency=frequency)
        except:
            return get_price_day_tx(xcode, end_date=end_date, count=count, frequency=frequency)
```

#### ğŸ“Š æ•°æ®èšåˆç®—æ³•

```python
def aggregate_data_by_frequency(df, frequency, target_count=1000):
    """æ ¹æ®é¢‘ç‡èšåˆåˆ†é’Ÿçº§æ•°æ®"""

    if frequency == '1d':  # æ—¥çº¿
        grouped = df.groupby('date_only').agg({
            'open': 'first',
            'high': 'max',
            'low': 'min',
            'close': 'last',
            'volume': 'sum'
        })
    elif frequency == '60m':  # å°æ—¶çº¿
        result = aggregate_hourly_trading_data(df)
    else:  # å…¶ä»–åˆ†é’Ÿçº¿
        freq_str = f'{minutes}T'
        aggregated = df_temp.resample(freq_str).agg({
            'open': 'first',
            'high': 'max',
            'low': 'min',
            'close': 'last',
            'volume': 'sum'
        })

    return result.tail(target_count)  # è¿”å›æœ€æ–°çš„target_countæ¡æ•°æ®
```

### ğŸ“ æ•°æ®å­˜å‚¨æ¶æ„

#### ğŸ—‚ï¸ ç›®å½•ç»“æ„è®¾è®¡

**ğŸ“‚ æ•°æ®ç»„ç»‡åŸåˆ™ï¼š**
- **æŒ‰å¹´ä»½åˆ†ç›®å½•ï¼š** ä¾¿äºç®¡ç†å’ŒæŸ¥æ‰¾
- **ç»Ÿä¸€å‘½åè§„èŒƒï¼š** å¸‚åœº.è‚¡ç¥¨ä»£ç .csv
- **æ ‡å‡†CSVæ ¼å¼ï¼š** å…¼å®¹æ€§å¥½ï¼Œæ˜“äºå¤„ç†
- **åˆ†é’Ÿçº§æ•°æ®ï¼š** æ”¯æŒæ‰€æœ‰å‘¨æœŸèšåˆ

#### ğŸ”§ é…ç½®ç®¡ç†

```python
# config.py - é…ç½®æ–‡ä»¶
LOCAL_DATA_PATH = r'E:\work\stock\data'

def get_stock_filename(code):
    """æ ¹æ®è‚¡ç¥¨ä»£ç ç”Ÿæˆæ–‡ä»¶å"""
    if code.startswith('sh') or code.startswith('sz'):
        stock_code = code[2:]
        market = 'SH' if code.startswith('sh') else 'SZ'
    elif '.XSHG' in code:
        stock_code = code.replace('.XSHG', '')
        market = 'SH'
    else:
        stock_code = code
        market = 'SH' if code.startswith('6') else 'SZ'

    return market, stock_code, f"{market}.{stock_code}.csv"
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ğŸ’» å¼€å‘ç¯å¢ƒéƒ¨ç½²

#### ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **Python 3.7+** - ä¸»è¦è¿è¡Œç¯å¢ƒ
- **ç°ä»£æµè§ˆå™¨** - Chromeã€Firefoxã€Safariã€Edge
- **4GB+ å†…å­˜** - æ¨èé…ç½®
- **1GB+ ç£ç›˜ç©ºé—´** - æ•°æ®å­˜å‚¨

#### âš¡ å¿«é€Ÿéƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/stock-k-chart.git
cd stock-k-chart

# 2. å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# 3. é…ç½®æ•°æ®è·¯å¾„ï¼ˆç¼–è¾‘config.pyï¼‰
LOCAL_DATA_PATH = r'E:\work\stock\data'

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python app.py

# 5. è®¿é—®åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€: http://127.0.0.1:5000
```

### ğŸ­ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### ğŸ³ Dockeréƒ¨ç½²

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 5000

CMD ["gunicorn", "--bind", "0.0.0.0:5000", "app:app"]
```

#### ğŸ”§ Nginxé…ç½®

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /static {
        alias /app/static;
        expires 30d;
    }
}
```

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–

| ä¼˜åŒ–æ–¹å‘ | æ–¹æ¡ˆ |
|---------|------|
| ğŸ’¾ **æ•°æ®ç¼“å­˜** | ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå‡å°‘ç£ç›˜I/O |
| ğŸ”„ **è´Ÿè½½å‡è¡¡** | ä½¿ç”¨Nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒå¤šå®ä¾‹éƒ¨ç½² |
| ğŸ“ˆ **ç›‘æ§å‘Šè­¦** | é›†æˆPrometheus + Grafanaç›‘æ§ç³»ç»Ÿ |
| ğŸ—„ï¸ **æ•°æ®åº“ä¼˜åŒ–** | è€ƒè™‘ä½¿ç”¨ClickHouseå­˜å‚¨æ—¶åºæ•°æ® |

## ğŸ‘¨â€ğŸ’» å¼€å‘æŒ‡å—

### ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

#### ğŸ“ ä»£ç è§„èŒƒ

```python
# Pythonä»£ç è§„èŒƒ (PEP 8)
def get_stock_data(code: str, period: str = 'D') -> pd.DataFrame:
    """
    è·å–è‚¡ç¥¨æ•°æ®

    Args:
        code: è‚¡ç¥¨ä»£ç 
        period: æ—¶é—´å‘¨æœŸ

    Returns:
        è‚¡ç¥¨æ•°æ®DataFrame
    """
    pass
```

#### ğŸ§ª æµ‹è¯•æ¡†æ¶

```python
import unittest
import pandas as pd
from Ashare import get_price

class TestAshare(unittest.TestCase):

    def test_get_price_local(self):
        """æµ‹è¯•æœ¬åœ°æ•°æ®è·å–"""
        df = get_price('sh600000', frequency='1d', count=10)
        self.assertIsInstance(df, pd.DataFrame)
        self.assertGreater(len(df), 0)

    def test_stock_code_format(self):
        """æµ‹è¯•è‚¡ç¥¨ä»£ç æ ¼å¼è§£æ"""
        from config import get_stock_filename
        market, code, filename = get_stock_filename('sh600000')
        self.assertEqual(market, 'SH')
        self.assertEqual(code, '600000')
        self.assertEqual(filename, 'SH.600000.csv')

if __name__ == '__main__':
    unittest.main()
```

### ğŸ”§ æ‰©å±•å¼€å‘

#### ğŸ“ˆ æ·»åŠ æ–°æŠ€æœ¯æŒ‡æ ‡

```javascript
// æ·»åŠ MACDæŒ‡æ ‡
function calculateMACD(data, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
    const emaFast = calculateEMA(data, fastPeriod);
    const emaSlow = calculateEMA(data, slowPeriod);

    const macdLine = emaFast.map((fast, i) => fast - emaSlow[i]);
    const signalLine = calculateEMA(macdLine, signalPeriod);
    const histogram = macdLine.map((macd, i) => macd - signalLine[i]);

    return { macdLine, signalLine, histogram };
}

// æ·»åŠ åˆ°å›¾è¡¨
const macdSeries = chart.addLineSeries({
    color: '#2196F3',
    lineWidth: 2,
});
macdSeries.setData(macdData);
```

#### ğŸ¨ è‡ªå®šä¹‰ç”»çº¿å·¥å…·

```javascript
// åˆ›å»ºè‡ªå®šä¹‰ç”»çº¿å·¥å…·
class FibonacciTool extends DrawingTool {
    constructor(chart, candleSeries) {
        super(chart, candleSeries);
        this.fibLevels = [0, 0.236, 0.382, 0.5, 0.618, 0.786, 1];
    }

    createDrawing() {
        if (this.points.length < 2) return;

        const [point1, point2] = this.points;
        const priceRange = point2.price - point1.price;

        this.fibLevels.forEach(level => {
            const price = point1.price + (priceRange * level);
            const priceLine = this.candleSeries.createPriceLine({
                price: price,
                color: '#FF9800',
                lineStyle: LightweightCharts.LineStyle.Dashed,
                title: `Fib ${(level * 100).toFixed(1)}%`
            });
        });
    }
}
```

### ğŸ“š APIæ‰©å±•

#### ğŸ”— æ–°å¢æ•°æ®æº

```python
# æ·»åŠ æ–°çš„æ•°æ®æº
def get_price_tushare(code, start_date, end_date):
    """ä½¿ç”¨Tushareæ•°æ®æº"""
    import tushare as ts

    pro = ts.pro_api('your_token')
    df = pro.daily(ts_code=code, start_date=start_date, end_date=end_date)

    # æ•°æ®æ ¼å¼è½¬æ¢
    df['date'] = pd.to_datetime(df['trade_date'])
    df = df.rename(columns={
        'open': 'open',
        'high': 'high',
        'low': 'low',
        'close': 'close',
        'vol': 'volume'
    })

    return df[['date', 'open', 'high', 'low', 'close', 'volume']]
```

## ğŸ”§ æ•…éšœæ’é™¤

### âŒ å¸¸è§é—®é¢˜

#### ğŸš« Kçº¿å›¾ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š**
- **è‚¡ç¥¨ä»£ç é”™è¯¯ï¼š** æ£€æŸ¥ä»£ç æ ¼å¼æ˜¯å¦æ­£ç¡®
- **æ•°æ®æ–‡ä»¶ç¼ºå¤±ï¼š** ç¡®è®¤CSVæ–‡ä»¶å­˜åœ¨äºå¯¹åº”å¹´ä»½ç›®å½•
- **JavaScripté”™è¯¯ï¼š** æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
- **ç½‘ç»œé—®é¢˜ï¼š** æ£€æŸ¥APIæ¥å£æ˜¯å¦æ­£å¸¸å“åº”

#### âš ï¸ æ•°æ®åŠ è½½å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®æ–‡ä»¶è·¯å¾„
ls -la /path/to/data/2024/SH.600000.csv

# æ£€æŸ¥æ–‡ä»¶æ ¼å¼
head -5 /path/to/data/2024/SH.600000.csv

# æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
tail -f backend_debug.log
```

#### ğŸ¨ ç”»çº¿å·¥å…·å¼‚å¸¸

**è°ƒè¯•æ­¥éª¤ï¼š**
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ
3. æ‰§è¡Œï¼š`window.checkDrawingToolStatus()`
4. æŸ¥çœ‹ç”»çº¿å·¥å…·ç³»ç»ŸçŠ¶æ€
5. å¦‚æœ‰é—®é¢˜ï¼Œæ‰§è¡Œï¼š`window.initProfessionalDrawingSystem()`

### ğŸ“Š æ€§èƒ½é—®é¢˜

#### ğŸŒ å›¾è¡¨æ¸²æŸ“ç¼“æ…¢

**ä¼˜åŒ–å»ºè®®ï¼š**
- **å‡å°‘æ•°æ®é‡ï¼š** é™åˆ¶å•æ¬¡åŠ è½½çš„Kçº¿æ•°é‡
- **å¯ç”¨æ•°æ®ç¼“å­˜ï¼š** é¿å…é‡å¤è¯·æ±‚ç›¸åŒæ•°æ®
- **ä¼˜åŒ–æ¸²æŸ“ï¼š** ä½¿ç”¨requestAnimationFrameä¼˜åŒ–åŠ¨ç”»
- **å†…å­˜ç®¡ç†ï¼š** åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„å›¾è¡¨åºåˆ—

#### ğŸ’¾ å†…å­˜å ç”¨è¿‡é«˜

```javascript
// å†…å­˜ä¼˜åŒ–ç¤ºä¾‹
function cleanupChart() {
    // æ¸…ç†ç”»çº¿å·¥å…·
    if (drawingToolSystem) {
        drawingToolSystem.clearAllDrawings();
    }

    // æ¸…ç†å›¾è¡¨åºåˆ—
    if (candleSeries) {
        klineChart.removeSeries(candleSeries);
    }

    // æ¸…ç†æ•°æ®ç¼“å­˜
    allCandleData = [];
    minuteData = [];

    console.log('âœ… å›¾è¡¨å†…å­˜æ¸…ç†å®Œæˆ');
}
```

### ğŸ” è°ƒè¯•å·¥å…·

#### ğŸ“ æ—¥å¿—ç³»ç»Ÿ

```javascript
// å‰ç«¯æ—¥å¿—è®°å½•
function logToFile(level, message, data = null) {
    const timestamp = new Date().toISOString();
    const logEntry = {
        timestamp,
        level,
        message,
        data
    };

    frontendLogs.push(logEntry);

    // é™åˆ¶æ—¥å¿—æ•°é‡
    if (frontendLogs.length > MAX_LOGS) {
        frontendLogs.shift();
    }

    console.log(`[${level}] ${message}`, data);
}

// å¯¼å‡ºæ—¥å¿—
function exportLogs() {
    const logsJson = JSON.stringify(frontendLogs, null, 2);
    const blob = new Blob([logsJson], { type: 'application/json' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = `frontend-logs-${Date.now()}.json`;
    a.click();
}
```

#### ğŸ§ª æµ‹è¯•å‘½ä»¤

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­å¯ç”¨çš„æµ‹è¯•å‘½ä»¤
window.testFunctions = {
    // æµ‹è¯•æ•°æ®åŠ è½½
    testDataLoading: () => loadKlineData(),

    // æµ‹è¯•ç”»çº¿å·¥å…·
    testDrawingTools: () => window.testDrawingTools(),

    // æµ‹è¯•åŠ¨ç”»æ’­æ”¾
    testAnimation: () => startAnimation(),

    // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
    checkStatus: () => ({
        chart: !!klineChart,
        candleSeries: !!candleSeries,
        drawingSystem: !!drawingToolSystem,
        dataCount: allCandleData.length
    }),

    // æ¸…ç†å’Œé‡ç½®
    reset: () => {
        stopAnimation();
        cleanupChart();
        location.reload();
    }
};

console.log('ğŸ§ª æµ‹è¯•å‘½ä»¤å·²åŠ è½½ï¼Œä½¿ç”¨ window.testFunctions è®¿é—®');
```

### ğŸ¯ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æµè§ˆå™¨ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿ
- é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- å¤ç°æ­¥éª¤
- ç›¸å…³çš„æ—¥å¿—æ–‡ä»¶

---

## ğŸ‰ æ„Ÿè°¢ä½¿ç”¨è‚¡ç¥¨Kçº¿å›¾å¯è§†åŒ–å¹³å°

> ä¸€ä¸ªä¸“ä¸šã€é«˜æ•ˆã€æ˜“ç”¨çš„è‚¡ç¥¨åˆ†æå·¥å…·

**æ ¸å¿ƒç‰¹æ€§ï¼š** ğŸ“Š ä¸“ä¸šå›¾è¡¨ | ğŸ¨ ç”»çº¿å·¥å…· | ğŸ¬ åŠ¨ç”»æ’­æ”¾ | ğŸ’¾ æœ¬åœ°æ•°æ®

**æŠ€æœ¯æ”¯æŒï¼š** å¦‚æœ‰é—®é¢˜è¯·æäº¤Issueæˆ–è”ç³»å¼€å‘å›¢é˜Ÿ

**å¼€æºåè®®ï¼š** MIT License - æ¬¢è¿è´¡çŒ®ä»£ç å’Œå»ºè®®
